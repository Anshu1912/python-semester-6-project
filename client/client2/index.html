<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload and Prediction</title>
    <!-- Your existing CSS styles -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <script src="path/to/your/model.js"></script>
</head>
<body>
    <!-- Your existing HTML structure -->

    <script>
        // Your existing JavaScript code

        // Load the model
        async function loadModel() {
            const model = await tf.loadLayersModel('path/to/your/model.json');
            return model;
        }

        // Function to make predictions
        async function makePrediction(imageData) {
            const model = await loadModel();
            const tensor = tf.browser.fromPixels(imageData, 1);
            const resizedTensor = tf.image.resizeBilinear(tensor, [224, 224]).div(255.0);
            const batched = resizedTensor.reshape([1, 224, 224, 3]);
            const predictions = await model.predict(batched).data();
            const maxPrediction = Math.max(...predictions);
            const classIndex = predictions.indexOf(maxPrediction);
            const confidence = (maxPrediction * 100).toFixed(2);
            const classLabels = ['Class1', 'Class2', 'Class3']; // Replace with your class labels
            const className = classLabels[classIndex];
            return { class: className, confidence: `${confidence}%` };
        }

        // Modify your existing code to use the makePrediction function
        fileInput.addEventListener('change', async () => {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async () => {
                    const img = document.createElement('img');
                    img.src = reader.result;
                    imageContainer.innerHTML = '';
                    imageContainer.appendChild(img);

                    loadingContainer.style.display = 'block';
                    predictionContainer.innerHTML = '';

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

                    const prediction = await makePrediction(imageData);

                    loadingContainer.style.display = 'none';
                    const classEl = document.createElement('p');
                    classEl.textContent = `Class: ${prediction.class}`;
                    const confidenceEl = document.createElement('p');
                    confidenceEl.textContent = `Confidence: ${prediction.confidence}`;
                    predictionContainer.appendChild(classEl);
                    predictionContainer.appendChild(confidenceEl);
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>